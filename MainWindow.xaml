<Window x:Class="PatronGamingMonitor.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="clr-namespace:PatronGamingMonitor.ViewModels"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:convert="clr-namespace:PatronGamingMonitor.Converters"
    xmlns:uc="clr-namespace:PatronGamingMonitor.UserControls"
    mc:Ignorable="d"
    DataContext="{StaticResource MainWindowVM}"
    Title="Patron Gaming Monitor"
    WindowStyle="None"
    WindowStartupLocation="CenterScreen"
    WindowState="Maximized"
    Icon="pack://application:,,,/Assets/Images/PRGAlogo.ico"
    Background="#F5F7FA">

    <Window.Resources>
        <convert:BooleanToVisibilityConverter x:Key="BooleanToVisibility" />
        <convert:TicketStatusToBrushConverter x:Key="TicketStatusToBrush" />
        <convert:FilterMatchConverter x:Key="FilterMatch" />
        <convert:InverseBooleanConverter x:Key="InverseBooleanConverter" />

        <LinearGradientBrush x:Key="HeaderGradient" StartPoint="0,0" EndPoint="1,0">
            <GradientStop Color="#233e57" Offset="0" />
            <GradientStop Color="#1A3650" Offset="0.5" />
            <GradientStop Color="#103252" Offset="1" />
        </LinearGradientBrush>

        <Style TargetType="TextBlock">
            <Setter Property="TextDecorations" Value="{x:Null}" />
        </Style>
    </Window.Resources>

    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Loaded">
            <i:InvokeCommandAction Command="{Binding LoadTicketsCommand}"
                CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}" />
        </i:EventTrigger>
    </i:Interaction.Triggers>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <!-- Network Status Bar -->
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- HEADER -->
        <Border Grid.Row="0"
            Background="{StaticResource HeaderGradient}"
            Height="85"
            MouseLeftButtonDown="TitleBar_MouseLeftButtonDown"
            Effect="{DynamicResource DropShadowEffect}">
            <Grid Margin="25,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Left logo/title -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <Border CornerRadius="10"
                        Margin="0,0,20,0"
                        Effect="{DynamicResource DropShadowEffect}">
                        <Image Source="/Assets/Images/NewLogo-01.png"
                            Height="100"
                            Width="105" />
                    </Border>

                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="Patron Responsible Gaming Alert"
                            FontSize="28"
                            FontWeight="Bold"
                            Foreground="White"
                            Effect="{DynamicResource TextShadowEffect}" />
                        <TextBlock Text="Real-Time Dashboard"
                            FontSize="15"
                            Foreground="#E1B7A7"
                            FontWeight="Medium"
                            Margin="0,3,0,0" />

                        <TextBlock Text="{Binding CurrentVersion}"
                            FontSize="13"
                            FontWeight="SemiBold"
                            Foreground="White"
                            Margin="0,4,0,0">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Style.Triggers>
                                        <!-- Show loading animation -->
                                        <DataTrigger Binding="{Binding CurrentVersion}"
                                            Value="Version: Loading...">
                                            <Setter Property="Foreground" Value="#E1B7A7" />
                                            <Setter Property="FontStyle" Value="Italic" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </StackPanel>

                </StackPanel>

                <!-- Clock & Date -->
                <Border Grid.Column="2"
                    CornerRadius="12"
                    Padding="100,10"
                    VerticalAlignment="Center">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="🕐" FontSize="28" VerticalAlignment="Center"
                            Foreground="#E1B7A7" Margin="0,0,12,0" />
                        <StackPanel>
                            <TextBlock Text="Current Time"
                                FontSize="13"
                                Foreground="#E1B7A7"
                                HorizontalAlignment="Center"
                                FontWeight="Medium" />
                            <TextBlock Text="{Binding CurrentTime}"
                                FontSize="26"
                                FontWeight="Bold"
                                Foreground="White"
                                FontFamily="Consolas"
                                HorizontalAlignment="Center" />
                            <TextBlock Text="{Binding CurrentDate}"
                                FontSize="12"
                                Foreground="#E1B7A7"
                                HorizontalAlignment="Center"
                                Margin="0,3,0,0" />
                        </StackPanel>
                    </StackPanel>
                </Border>


            </Grid>
        </Border>

        <!-- ADDED: Overlay the control bar in the top-right of the header -->
        <uc:ControlBarChildWindowUC
            Grid.Row="0"
            HorizontalAlignment="Right"
            VerticalAlignment="Top"
            Margin="0,0,10,0"
            Panel.ZIndex="1000"
            Tag="" />

        <!-- NETWORK STATUS BAR -->
        <Border Grid.Row="1"
            Background="#FF6B6B"
            Height="45"
            Panel.ZIndex="999"
            Visibility="{Binding IsNetworkDisconnected, Converter={StaticResource BooleanToVisibility}}">
            <Grid Margin="20,0">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center"
                    VerticalAlignment="Center">
                    <!-- Spinning Icon -->
                    <TextBlock Text="⚠" FontSize="20" Foreground="White" Margin="0,0,12,0"
                        VerticalAlignment="Center">
                        <TextBlock.RenderTransform>
                            <RotateTransform x:Name="NetworkIconRotation" CenterX="10" CenterY="10" />
                        </TextBlock.RenderTransform>
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsReconnecting}" Value="True">
                                        <DataTrigger.EnterActions>
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <DoubleAnimation
                                                        Storyboard.TargetProperty="(TextBlock.RenderTransform).(RotateTransform.Angle)"
                                                        From="0" To="360" Duration="0:0:2"
                                                        RepeatBehavior="Forever" />
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </DataTrigger.EnterActions>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>

                    <!-- Status Message -->
                    <TextBlock FontSize="15" FontWeight="SemiBold" Foreground="White"
                        VerticalAlignment="Center">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Text"
                                    Value="Network Disconnected - Connection Lost" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsReconnecting}" Value="True">
                                        <Setter Property="Text"
                                            Value="{Binding NetworkStatusMessage}" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>

                    <!-- Retry Button -->
                    <Button Content="Retry Now"
                        Margin="20,0,0,0"
                        Padding="15,5"
                        FontSize="13"
                        FontWeight="Bold"
                        Background="White"
                        Foreground="#FF6B6B"
                        BorderThickness="0"
                        Cursor="Hand"
                        Command="{Binding RetryConnectionCommand}"
                        Visibility="{Binding IsReconnecting, Converter={StaticResource InverseBooleanConverter}}">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}"
                                                CornerRadius="5"
                                                Padding="{TemplateBinding Padding}">
                                                <ContentPresenter HorizontalAlignment="Center"
                                                    VerticalAlignment="Center" />
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#F0F0F0" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- MAIN CONTENT -->
        <Grid Grid.Row="2" Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Filter Buttons + Toggle -->
            <Border Grid.Row="0"
                Background="White"
                CornerRadius="12"
                Padding="18"
                Margin="0,0,0,15"
                Effect="{DynamicResource DropShadowEffect}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Filter buttons -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        <TextBlock Text="Filters:"
                            FontSize="17"
                            FontWeight="Bold"
                            VerticalAlignment="Center"
                            Foreground="#1A3650"
                            Margin="0,0,20,0" />

                        <Button Content="All Players"
                            FontSize="15"
                            Width="120" Height="40"
                            Margin="0,0,12,0"
                            Command="{Binding ApplyFilterCommand}"
                            CommandParameter="All"
                            Style="{StaticResource FilterButtonStyle}" />

                        <Button Content="Alerted Players"
                            FontSize="15"
                            Width="130" Height="40"
                            Margin="0,0,12,0"
                            Command="{Binding ApplyFilterCommand}"
                            CommandParameter="&lt;30"
                            Style="{StaticResource FilterButtonStyle}" />

                        <!--<Button
                        Content="Overstayed"
            Width="140" Height="40"
            Margin="0,0,20,0"
            Command="{Binding ApplyFilterCommand}"
            CommandParameter="Overstayed"
            Style="{StaticResource FilterButtonStyle}"/>-->

                        <!-- Search TextBox -->
                        <Border Background="#F8F9FA"
                            BorderBrush="#DEE2E6"
                            BorderThickness="2"
                            CornerRadius="8"
                            Padding="8,0"
                            Height="40"
                            Width="300">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <!-- Search Icon -->
                                <TextBlock Text="🔎"
                                    FontSize="16"
                                    VerticalAlignment="Center"
                                    Margin="4,0,8,0"
                                    Opacity="0.6" />

                                <!-- Search TextBox -->
                                <TextBox Grid.Column="1"
                                    Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                    VerticalAlignment="Center"
                                    BorderThickness="0"
                                    Background="Transparent"
                                    FontSize="13"
                                    Foreground="#1A3650">
                                    <TextBox.Style>
                                        <Style TargetType="TextBox">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="TextBox">
                                                        <Grid>
                                                            <ScrollViewer x:Name="PART_ContentHost"
                                                                VerticalAlignment="Center" />
                                                            <TextBlock
                                                                Text="Search by ID, Name, Location, Type, Pit..."
                                                                VerticalAlignment="Center"
                                                                Foreground="#999"
                                                                FontSize="13"
                                                                IsHitTestVisible="False">
                                                                <TextBlock.Style>
                                                                    <Style TargetType="TextBlock">
                                                                        <Setter
                                                                            Property="Visibility"
                                                                            Value="Collapsed" />
                                                                        <Style.Triggers>
                                                                            <DataTrigger
                                                                                Binding="{Binding Text, RelativeSource={RelativeSource TemplatedParent}}"
                                                                                Value="">
                                                                                <Setter
                                                                                    Property="Visibility"
                                                                                    Value="Visible" />
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </TextBlock.Style>
                                                            </TextBlock>
                                                        </Grid>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </TextBox.Style>
                                </TextBox>

                                <!-- Clear Button -->
                                <Button Grid.Column="2"
                                    Content="✕"
                                    Width="20"
                                    Height="20"
                                    FontSize="12"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Foreground="#999"
                                    Cursor="Hand"
                                    Command="{Binding ClearSearchCommand}"
                                    Visibility="{Binding SearchText, Converter={StaticResource BooleanToVisibility}}">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border
                                                            Background="{TemplateBinding Background}"
                                                            CornerRadius="10"
                                                            Padding="2">
                                                            <ContentPresenter
                                                                HorizontalAlignment="Center"
                                                                VerticalAlignment="Center" />
                                                        </Border>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#FFE0E0" />
                                                    <Setter Property="Foreground" Value="#FF4444" />
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                            </Grid>
                        </Border>
                    </StackPanel>

                    <!-- Checkbox -->
                    <Border Grid.Column="2"
                        CornerRadius="10"
                        Padding="10"
                        BorderThickness="2" Height="64" VerticalAlignment="Top" Margin="0,0,12,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Playing time:"
                                FontSize="17"
                                FontWeight="Bold"
                                VerticalAlignment="Center"
                                Foreground="#1A3650"
                                Margin="0,0,15,0" />

                            <CheckBox Content="> 12H"
                                IsChecked="{Binding IsFilter12HoursChecked}"
                                Style="{StaticResource StatusCheckBoxStyle}"
                                Width="100" Height="40"
                                Margin="0,0,8,0" />

                            <CheckBox Content="> 24H"
                                IsChecked="{Binding IsFilter24HoursChecked}"
                                Style="{StaticResource StatusCheckBoxStyle}"
                                Width="100" Height="40"
                                Margin="0,0,8,0" />

                            <CheckBox Content="> 48H"
                                IsChecked="{Binding IsFilter48HoursChecked}"
                                Style="{StaticResource StatusCheckBoxStyle}"
                                Width="100" Height="40" />
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <!-- DataGrid Container -->
            <Border Grid.Row="1"
                Background="White"
                CornerRadius="14"
                Padding="18"
                BorderBrush="#E0E0E0"
                BorderThickness="1"
                Effect="{DynamicResource DropShadowEffect}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!-- Header info -->
                    <Border Grid.Row="0"
    Background="#F8F9FA"
    CornerRadius="8"
    Padding="12"
    Margin="0,0,0,12">
                        <Grid>
                            <TextBlock HorizontalAlignment="Left" VerticalAlignment="Center">
            <Run Text="Total: " FontWeight="Bold"
                Foreground="#1A3650" FontSize="15" />
            <Run Text="{Binding TotalCount, Mode=OneWay}" FontWeight="Bold"
                Foreground="#E74C3C" FontSize="17" />
                            </TextBlock>

                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                                <!-- Table Filter -->
                                <TextBlock VerticalAlignment="Center" Cursor="Hand" 
                       MouseLeftButtonDown="TableFilter_Click"
                       ToolTip="Click to filter by Table">
                <Run Text="Table: " Foreground="#1A3650" FontSize="15" />
                <Run Text="{Binding TotalTable, Mode=OneWay}" FontWeight="Bold"
                    Foreground="#1A3650" FontSize="15" />
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="TextDecorations" Value="Underline" />
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>

                                <TextBlock Text=" / " Foreground="#1A3650" FontSize="13" 
                       Margin="5,0" VerticalAlignment="Center" />

                                <!-- Slot Filter -->
                                <TextBlock VerticalAlignment="Center" Cursor="Hand"
                       MouseLeftButtonDown="SlotFilter_Click"
                       ToolTip="Click to filter by Slot">
                <Run Text="Slot: " Foreground="#1A3650" FontSize="15" />
                <Run Text="{Binding TotalSlot, Mode=OneWay}" FontWeight="Bold"
                    Foreground="#1A3650" FontSize="15" />
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="TextDecorations" Value="Underline" />
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <Grid Grid.Row="1">
                        <DataGrid ItemsSource="{Binding AllTicketsSource}"
                            IsSynchronizedWithCurrentItem="True"
                            HeadersVisibility="Column"
                            RowHeaderWidth="0"
                            AutoGenerateColumns="False"
                            CanUserAddRows="False"
                            CanUserDeleteRows="False"
                            CanUserSortColumns="True"
                            Sorting="DataGrid_Sorting"
                            GridLinesVisibility="Horizontal"
                            HorizontalGridLinesBrush="#F0F0F0"
                            MouseDoubleClick="DataGrid_MouseDoubleClick"
                            IsReadOnly="True"
                            SelectionMode="Single"
                            SelectionUnit="FullRow"
                            EnableRowVirtualization="True"
                            EnableColumnVirtualization="True"
                            ScrollViewer.CanContentScroll="True"
                            ScrollViewer.VerticalScrollBarVisibility="Auto"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Stretch"
                            FontSize="13"
                            RowHeight="30"
                            BorderThickness="0"
                            RowStyle="{StaticResource DataGridRowStyle}"
                            ColumnHeaderStyle="{StaticResource DataGridColumnHeaderStyle}"
                            CellStyle="{StaticResource DataGridCellStyle}">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Player ID" Binding="{Binding PlayerID}"
                                    Width="*" SortMemberPath="PlayerID" />
                                <DataGridTextColumn Header="Full Name" Binding="{Binding FullName}"
                                    Width="2*" SortMemberPath="FullName" />
                                <DataGridTextColumn Header="Area" Binding="{Binding Area}"
                                    Width="*" SortMemberPath="Area" />
                                <DataGridTextColumn Header="Location" Binding="{Binding Location}"
                                    Width="*" SortMemberPath="Location" />
                                <DataGridTextColumn Header="Seat" Binding="{Binding Seat}" Width="*"
                                    SortMemberPath="Seat" />
                                <DataGridTextColumn Header="Row" Binding="{Binding Row}" Width="*"
                                    SortMemberPath="Row" />
                                <DataGridTextColumn Header="Pit" Binding="{Binding PitName}"
                                    Width="*" SortMemberPath="PitName" />
                                <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="*"
                                    SortMemberPath="Type" />
                                <DataGridTextColumn Header="Local Status"
                                    Binding="{Binding LocalStatus}" Width="*"
                                    SortMemberPath="LocalStatus" />
                                <DataGridTextColumn Header="Playing Time"
                                    Binding="{Binding FormattedPlayingTime}"
                                    Width="1.2*"
                                    SortMemberPath="PlayingTime"
                                    ElementStyle="{StaticResource CountdownCellStyle}" />
                                <!--<DataGridTextColumn
                                Header="Start Time"
                                                          Binding="{Binding StartTime, StringFormat={}{0:yyyy-MM-dd HH:mm:ss}}"
                                                          Width="1.5*"
                                                          SortMemberPath="StartTime" />
                                <DataGridTextColumn Header="Ticket No" Binding="{Binding TransactionNo}" Width="1.5*"
                                SortMemberPath="TransactionNo" />
                                <DataGridTextColumn Header="Status" Binding="{Binding UsedStatus}" Width="*"
                                SortMemberPath="UsedStatus" />-->
                            </DataGrid.Columns>
                        </DataGrid>
                        <!-- WAVE LOADING ANIMATION (Google-style) -->
                        <Border
                            Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibility}}"
                            Background="#F0FFFFFF"
                            CornerRadius="8"
                            Panel.ZIndex="100">
                            <StackPanel HorizontalAlignment="Center"
                                VerticalAlignment="Center">
                                <!-- Wave Animation -->
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Ellipse x:Name="Wave1" Width="15" Height="15" Fill="#1A3650"
                                        Margin="5">
                                        <Ellipse.RenderTransform>
                                            <TranslateTransform Y="0" />
                                        </Ellipse.RenderTransform>
                                        <Ellipse.Triggers>
                                            <EventTrigger RoutedEvent="Loaded">
                                                <BeginStoryboard>
                                                    <Storyboard RepeatBehavior="Forever">
                                                        <DoubleAnimation
                                                            Storyboard.TargetProperty="(RenderTransform).(TranslateTransform.Y)"
                                                            From="0" To="-20" Duration="0:0:0.6"
                                                            AutoReverse="True">
                                                            <DoubleAnimation.EasingFunction>
                                                                <SineEase EasingMode="EaseInOut" />
                                                            </DoubleAnimation.EasingFunction>
                                                        </DoubleAnimation>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </EventTrigger>
                                        </Ellipse.Triggers>
                                    </Ellipse>

                                    <Ellipse x:Name="Wave2" Width="15" Height="15" Fill="#E1B7A7"
                                        Margin="5">
                                        <Ellipse.RenderTransform>
                                            <TranslateTransform Y="0" />
                                        </Ellipse.RenderTransform>
                                        <Ellipse.Triggers>
                                            <EventTrigger RoutedEvent="Loaded">
                                                <BeginStoryboard>
                                                    <Storyboard RepeatBehavior="Forever">
                                                        <DoubleAnimation
                                                            Storyboard.TargetProperty="(RenderTransform).(TranslateTransform.Y)"
                                                            From="0" To="-20" Duration="0:0:0.6"
                                                            AutoReverse="True"
                                                            BeginTime="0:0:0.1">
                                                            <DoubleAnimation.EasingFunction>
                                                                <SineEase EasingMode="EaseInOut" />
                                                            </DoubleAnimation.EasingFunction>
                                                        </DoubleAnimation>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </EventTrigger>
                                        </Ellipse.Triggers>
                                    </Ellipse>

                                    <Ellipse x:Name="Wave3" Width="15" Height="15" Fill="#1A3650"
                                        Margin="5">
                                        <Ellipse.RenderTransform>
                                            <TranslateTransform Y="0" />
                                        </Ellipse.RenderTransform>
                                        <Ellipse.Triggers>
                                            <EventTrigger RoutedEvent="Loaded">
                                                <BeginStoryboard>
                                                    <Storyboard RepeatBehavior="Forever">
                                                        <DoubleAnimation
                                                            Storyboard.TargetProperty="(RenderTransform).(TranslateTransform.Y)"
                                                            From="0" To="-20" Duration="0:0:0.6"
                                                            AutoReverse="True"
                                                            BeginTime="0:0:0.2">
                                                            <DoubleAnimation.EasingFunction>
                                                                <SineEase EasingMode="EaseInOut" />
                                                            </DoubleAnimation.EasingFunction>
                                                        </DoubleAnimation>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </EventTrigger>
                                        </Ellipse.Triggers>
                                    </Ellipse>

                                    <Ellipse x:Name="Wave4" Width="15" Height="15" Fill="#E1B7A7"
                                        Margin="5">
                                        <Ellipse.RenderTransform>
                                            <TranslateTransform Y="0" />
                                        </Ellipse.RenderTransform>
                                        <Ellipse.Triggers>
                                            <EventTrigger RoutedEvent="Loaded">
                                                <BeginStoryboard>
                                                    <Storyboard RepeatBehavior="Forever">
                                                        <DoubleAnimation
                                                            Storyboard.TargetProperty="(RenderTransform).(TranslateTransform.Y)"
                                                            From="0" To="-20" Duration="0:0:0.6"
                                                            AutoReverse="True"
                                                            BeginTime="0:0:0.3">
                                                            <DoubleAnimation.EasingFunction>
                                                                <SineEase EasingMode="EaseInOut" />
                                                            </DoubleAnimation.EasingFunction>
                                                        </DoubleAnimation>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </EventTrigger>
                                        </Ellipse.Triggers>
                                    </Ellipse>
                                </StackPanel>

                                <TextBlock Text="Loading tickets..."
                                    FontSize="16"
                                    FontWeight="SemiBold"
                                    Foreground="#1A3650"
                                    HorizontalAlignment="Center"
                                    Margin="0,20,0,0" />
                            </StackPanel>
                        </Border>
                    </Grid>
                </Grid>
            </Border>

            <!-- Pagination -->
            <Border Grid.Row="2"
                Background="White"
                CornerRadius="12"
                Padding="18"
                Margin="0,15,0,0"
                Effect="{DynamicResource DropShadowEffect}">
                <StackPanel Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">

                    <Button Content="⟨⟨ Previous"
                        Width="110"
                        Height="40"
                        Margin="0,0,25,0"
                        Style="{StaticResource MainButtonStyle}"
                        Command="{Binding PrevPageCommand}" />

                    <Border Background="#F0F4F5"
                        CornerRadius="10"
                        Padding="20,10"
                        BorderBrush="#1A3650"
                        BorderThickness="2">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding PageIndex}"
                                FontSize="20"
                                FontWeight="Bold"
                                Foreground="#1A3650"
                                VerticalAlignment="Center" />
                            <TextBlock Text=" / "
                                FontSize="20"
                                Margin="8,0"
                                Foreground="#7F8C8D"
                                VerticalAlignment="Center" />
                            <TextBlock Text="{Binding TotalPages}"
                                FontSize="20"
                                FontWeight="Bold"
                                Foreground="#1A3650"
                                VerticalAlignment="Center" />
                        </StackPanel>
                    </Border>

                    <Button Content="Next ⟩⟩"
                        Width="110"
                        Height="40"
                        Margin="25,0,0,0"
                        Style="{StaticResource MainButtonStyle}"
                        Command="{Binding NextPageCommand}" />
                </StackPanel>
            </Border>
        </Grid>

        <Grid.Resources>
            <DropShadowEffect x:Key="DropShadowEffect"
                BlurRadius="18"
                ShadowDepth="3"
                Opacity="0.15"
                Color="#1A3650" />
            <DropShadowEffect x:Key="TextShadowEffect"
                BlurRadius="10"
                ShadowDepth="2"
                Opacity="0.5"
                Color="Black" />
        </Grid.Resources>
    </Grid>
</Window>